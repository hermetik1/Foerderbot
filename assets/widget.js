(()=>{"use strict";var t={40:(t,n,e)=>{e.d(n,{A:()=>o});var r=e(601),i=e.n(r),a=e(314),s=e.n(a)()(i());s.push([t.id,"/* KI Kraft Widget - Layout Styles */\n\n/* Fullscreen Layout for Member Chat */\n.kk-fullscreen {\n\tposition: fixed;\n\tinset: 0;\n\tdisplay: grid;\n\tgrid-template-columns: 56px 1fr;\n\tbackground: var(--kk-bg, var(--kk-surface));\n\tcolor: var(--kk-fg, var(--kk-text));\n\tz-index: 9999;\n}\n\n/* Rail for Fullscreen Mode (left column) */\n.kk-fullscreen .kk-rail {\n\tposition: static;\n\twidth: 56px;\n\theight: 100%;\n\ttransform: none;\n\tborder-radius: 0;\n\tborder: none;\n\tborder-right: 1px solid var(--kk-border);\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tgap: 8px;\n\tpadding: 8px 6px;\n\tbackground: var(--kk-surface);\n}\n\n.kk-fullscreen .kk-rail-btn {\n\twidth: 44px;\n\theight: 44px;\n\tborder-radius: 12px;\n\tdisplay: grid;\n\tplace-items: center;\n\tborder: none;\n\tbackground: transparent;\n\tcolor: var(--kk-text);\n\tcursor: pointer;\n\tfont-size: 18px;\n\ttransition: background 0.2s;\n}\n\n.kk-fullscreen .kk-rail-btn:hover {\n\tbackground: var(--kk-surface-2);\n}\n\n.kk-fullscreen .kk-rail-btn:focus-visible {\n\toutline: var(--kk-focus);\n}\n\n.kk-fullscreen .kk-rail-avatar {\n\twidth: 44px;\n\theight: 44px;\n\tborder-radius: 50%;\n\toverflow: hidden;\n\tcursor: pointer;\n\tmargin-bottom: 8px;\n}\n\n.kk-fullscreen .kk-rail-new {\n\tbackground: var(--kk-primary);\n\tcolor: var(--kk-primary-contrast);\n\tfont-size: 24px;\n\tfont-weight: 300;\n}\n\n.kk-fullscreen .kk-rail-lang {\n\tmargin-top: auto;\n\tfont-size: 11px;\n\tcolor: var(--kk-text-muted);\n\tfont-weight: 600;\n\tpadding: 4px 0;\n}\n\n/* Sidebar in Fullscreen Mode */\n.kk-fullscreen .kk-sidebar {\n\tposition: static;\n\twidth: 100%;\n\theight: 100%;\n\ttransform: none;\n\tborder: none;\n\tbox-shadow: none;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.kk-fullscreen .kk-sidebar:not(.open) {\n\tdisplay: none;\n}\n\n.kk-fullscreen .kk-sidebar__header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\theight: 56px;\n\tpadding: 0 16px;\n\tborder-bottom: 1px solid var(--kk-border);\n\tbackground: var(--kk-surface);\n}\n\n.kk-fullscreen .kk-header-left {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 16px;\n}\n\n.kk-fullscreen .kk-brand {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n}\n\n.kk-fullscreen .kk-brand-logo {\n\twidth: 32px;\n\theight: 32px;\n\tborder-radius: 8px;\n}\n\n.kk-fullscreen .kk-brand-title {\n\tfont-weight: 600;\n\tfont-size: 16px;\n}\n\n.kk-fullscreen .kk-conv-title {\n\tfont-size: 14px;\n\tcolor: var(--kk-text-muted);\n}\n\n.kk-fullscreen .kk-body {\n\tdisplay: grid;\n\tgrid-template-columns: 280px 1fr;\n\theight: calc(100% - 56px - 82px);\n\toverflow: hidden;\n}\n\n/* History Navigation */\n.kk-history {\n\tborder-right: 1px solid var(--kk-border);\n\tpadding: 12px;\n\toverflow: auto;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n\tbackground: var(--kk-surface);\n}\n\n.kk-history-search {\n\tposition: relative;\n}\n\n.kk-history-search-input {\n\twidth: 100%;\n\tpadding: 8px 12px;\n\tborder: 1px solid var(--kk-border);\n\tborder-radius: 8px;\n\tfont-size: 13px;\n\tbackground: var(--kk-surface-2);\n\tcolor: var(--kk-text);\n}\n\n.kk-history-search-input:focus {\n\toutline: var(--kk-focus);\n}\n\n.kk-new-chat-btn {\n\twidth: 100%;\n\tpadding: 10px;\n\tbackground: #22c55e;\n\tcolor: white;\n\tborder: none;\n\tborder-radius: 8px;\n\tfont-weight: 600;\n\tcursor: pointer;\n\tfont-size: 14px;\n\ttransition: filter 0.2s;\n}\n\n.kk-new-chat-btn:hover {\n\tfilter: brightness(1.1);\n}\n\n.kk-history-list {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 4px;\n\tflex: 1;\n}\n\n.kk-history-item {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 10px 12px;\n\tborder-radius: 8px;\n\tcursor: pointer;\n\ttransition: background 0.2s;\n\tborder: 1px solid transparent;\n}\n\n.kk-history-item:hover {\n\tbackground: var(--kk-surface-2);\n}\n\n.kk-history-item.active {\n\tbackground: var(--kk-surface-2);\n\tborder-color: var(--kk-border);\n}\n\n.kk-history-title {\n\tflex: 1;\n\tfont-size: 14px;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n\n.kk-history-actions {\n\tdisplay: flex;\n\tgap: 4px;\n\topacity: 0;\n\ttransition: opacity 0.2s;\n}\n\n.kk-history-item:hover .kk-history-actions {\n\topacity: 1;\n}\n\n.kk-history-rename,\n.kk-history-delete {\n\twidth: 28px;\n\theight: 28px;\n\tborder: none;\n\tbackground: transparent;\n\tcursor: pointer;\n\tborder-radius: 4px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 14px;\n}\n\n.kk-history-rename:hover,\n.kk-history-delete:hover {\n\tbackground: var(--kk-border);\n}\n\n/* Chat Area in Fullscreen */\n.kk-fullscreen .kk-chat {\n\tposition: relative;\n\toverflow: auto;\n\tpadding: 16px 24px;\n\tbackground: var(--kk-surface);\n}\n\n.kk-fullscreen .kk-messages {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n\tmax-width: 800px;\n\tmargin: 0 auto;\n}\n\n.kk-fullscreen .kk-message {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 6px;\n}\n\n.kk-fullscreen .kk-message.user {\n\talign-items: flex-end;\n}\n\n.kk-fullscreen .kk-message.bot {\n\talign-items: flex-start;\n}\n\n.kk-fullscreen .kk-message-content {\n\tmax-width: 68ch;\n\tpadding: 12px 14px;\n\tborder-radius: 14px;\n\tline-height: 1.6;\n}\n\n.kk-fullscreen .kk-message.user .kk-message-content {\n\tbackground: var(--kk-primary);\n\tcolor: var(--kk-primary-contrast);\n\tborder-radius: 14px 14px 0 14px;\n}\n\n.kk-fullscreen .kk-message.bot .kk-message-content {\n\tbackground: var(--kk-surface-2);\n\tcolor: var(--kk-text);\n\tborder-radius: 14px 14px 14px 0;\n\tborder: 1px solid var(--kk-border);\n}\n\n.kk-message-actions {\n\tdisplay: flex;\n\tgap: 10px;\n\tmargin-top: 6px;\n\topacity: 0.85;\n}\n\n.kk-msg-copy,\n.kk-msg-retry,\n.kk-msg-like,\n.kk-msg-dislike,\n.kk-msg-delete {\n\twidth: 32px;\n\theight: 32px;\n\tborder: none;\n\tbackground: transparent;\n\tcursor: pointer;\n\tborder-radius: 6px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 16px;\n\ttransition: background 0.2s;\n}\n\n.kk-msg-copy:hover,\n.kk-msg-retry:hover,\n.kk-msg-like:hover,\n.kk-msg-dislike:hover,\n.kk-msg-delete:hover {\n\tbackground: var(--kk-surface-2);\n}\n\n/* Composer in Fullscreen */\n.kk-fullscreen .kk-composer {\n\tdisplay: flex;\n\tgap: 10px;\n\talign-items: center;\n\tpadding: 14px 16px;\n\tborder-top: 1px solid var(--kk-border);\n\tbackground: var(--kk-surface);\n\tmin-height: 82px;\n}\n\n.kk-fullscreen .kk-mic-btn {\n\twidth: 44px;\n\theight: 44px;\n\tborder: none;\n\tbackground: transparent;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tfont-size: 20px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\ttransition: background 0.2s;\n}\n\n.kk-fullscreen .kk-mic-btn:hover {\n\tbackground: var(--kk-surface-2);\n}\n\n.kk-fullscreen .kk-input {\n\tflex: 1;\n\tmin-height: 44px;\n\tmax-height: 120px;\n\tborder-radius: 24px;\n\tpadding: 10px 16px;\n\tborder: 1px solid var(--kk-border);\n\tbackground: var(--kk-surface-2);\n\tcolor: var(--kk-text);\n\tfont-family: inherit;\n\tfont-size: 14px;\n\tresize: none;\n}\n\n.kk-fullscreen .kk-input:focus {\n\toutline: var(--kk-focus);\n}\n\n.kk-fullscreen .kk-send-btn {\n\twidth: 44px;\n\theight: 44px;\n\tborder: none;\n\tbackground: var(--kk-primary);\n\tcolor: var(--kk-primary-contrast);\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tfont-size: 20px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\ttransition: filter 0.2s;\n}\n\n.kk-fullscreen .kk-send-btn:hover {\n\tfilter: brightness(1.1);\n}\n\n.kk-fullscreen .kk-send-btn:disabled {\n\topacity: 0.5;\n\tcursor: not-allowed;\n}\n\n/* Legal Footer */\n.kk-legal {\n\tposition: absolute;\n\tbottom: 8px;\n\tright: 16px;\n\tfont-size: 12px;\n\topacity: 0.8;\n\tdisplay: flex;\n\tgap: 8px;\n\talign-items: center;\n}\n\n.kk-legal-text {\n\tcolor: var(--kk-text-muted);\n}\n\n.kk-legal-link {\n\tcolor: var(--kk-primary);\n\ttext-decoration: none;\n}\n\n.kk-legal-link:hover {\n\ttext-decoration: underline;\n}\n\n/* Floating Mode Rail (legacy) */\n.kk-rail {\n\tposition: fixed;\n\tright: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\twidth: 36px;\n\tbackground: var(--kk-surface);\n\tborder: 1px solid var(--kk-border);\n\tborder-right: none;\n\tborder-radius: 8px 0 0 8px;\n\tpadding: 8px 4px;\n\tz-index: 9998;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8px;\n\talign-items: center;\n}\n\n.kk-rail-btn {\n\twidth: 28px;\n\theight: 28px;\n\tborder: none;\n\tbackground: transparent;\n\tcolor: var(--kk-primary);\n\tborder-radius: 8px;\n\tcursor: pointer;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\ttransition: filter 0.2s;\n\tfont-size: 16px;\n}\n\n.kk-rail-btn:hover {\n\tfilter: brightness(0.95);\n\tbackground: var(--kk-surface-2);\n}\n\n.kk-rail-btn:focus-visible {\n\toutline: var(--kk-focus);\n}\n\n.kk-rail-avatar {\n\twidth: 28px;\n\theight: 28px;\n\tborder-radius: 50%;\n\toverflow: hidden;\n\tcursor: pointer;\n\tborder: 2px solid var(--kk-border);\n}\n\n.kk-rail-avatar-placeholder {\n\twidth: 28px;\n\theight: 28px;\n\tborder-radius: 50%;\n\tbackground: var(--kk-primary);\n\tcolor: var(--kk-primary-contrast);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-weight: bold;\n\tcursor: pointer;\n}\n\n.kk-sidebar {\n\tposition: fixed;\n\tright: 0;\n\ttop: 0;\n\twidth: 360px;\n\theight: 100vh;\n\tbackground: var(--kk-surface);\n\tborder-left: 1px solid var(--kk-border);\n\tz-index: 9999;\n\ttransform: translateX(100%);\n\ttransition: transform 0.3s ease;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbox-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);\n}\n\n.kk-sidebar.open {\n\ttransform: translateX(0);\n}\n\n.kk-sidebar__header {\n\tpadding: 16px;\n\tborder-bottom: 1px solid var(--kk-border);\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tbackground: var(--kk-surface-2);\n}\n\n.kk-header-info {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 4px;\n}\n\n.kk-type-badge {\n\tfont-size: 10px;\n\tcolor: var(--kk-text-muted);\n\ttext-transform: uppercase;\n\tletter-spacing: 0.5px;\n}\n\n.kk-close-btn {\n\twidth: 28px;\n\theight: 28px;\n\tborder: none;\n\tbackground: transparent;\n\tcolor: var(--kk-text-muted);\n\tborder-radius: 4px;\n\tcursor: pointer;\n\tfont-size: 20px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\ttransition: all 0.2s;\n}\n\n.kk-close-btn:hover {\n\tbackground: var(--kk-border);\n\tcolor: var(--kk-text);\n}\n\n.kk-chat {\n\tflex: 1;\n\toverflow-y: auto;\n\tpadding: 16px;\n\tbackground: var(--kk-surface);\n}\n\n.kk-messages {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n}\n\n.kk-composer {\n\tpadding: 16px;\n\tborder-top: 1px solid var(--kk-border);\n\tdisplay: flex;\n\tgap: 8px;\n\tbackground: var(--kk-surface-2);\n}\n\n.kk-input {\n\tflex: 1;\n\tpadding: 10px;\n\tborder: 1px solid var(--kk-border);\n\tborder-radius: 8px;\n\tresize: none;\n\tfont-family: inherit;\n\tfont-size: 14px;\n\tcolor: var(--kk-text);\n\tbackground: var(--kk-surface);\n\tmax-height: 120px;\n}\n\n.kk-input:focus {\n\toutline: var(--kk-focus);\n}\n\n.kk-send-btn {\n\talign-self: flex-end;\n\tpadding: 10px 16px;\n\twhite-space: nowrap;\n}\n\n/* Mobile Responsive */\n@media (max-width: 768px) {\n\t.kk-fullscreen {\n\t\tgrid-template-columns: 1fr;\n\t\tgrid-template-rows: auto 1fr;\n\t}\n\t\n\t.kk-fullscreen .kk-rail {\n\t\twidth: 100%;\n\t\theight: auto;\n\t\tflex-direction: row;\n\t\tborder-right: none;\n\t\tborder-bottom: 1px solid var(--kk-border);\n\t}\n\t\n\t.kk-fullscreen .kk-body {\n\t\tgrid-template-columns: 1fr;\n\t\theight: calc(100% - 56px - 82px - 56px);\n\t}\n\t\n\t.kk-history {\n\t\tdisplay: none;\n\t}\n\t\n\t.kk-fullscreen .kk-sidebar:not(.open) {\n\t\tdisplay: flex;\n\t}\n}\n\n@media (max-width: 640px) {\n\t.kk-sidebar {\n\t\twidth: 100%;\n\t}\n\t\n\t.kk-rail-btn {\n\t\twidth: 44px;\n\t\theight: 44px;\n\t}\n\t\n\t.kk-rail-avatar,\n\t.kk-rail-avatar-placeholder {\n\t\twidth: 44px;\n\t\theight: 44px;\n\t}\n}\n",""]);const o=s},56:(t,n,e)=>{t.exports=function(t){var n=e.nc;n&&t.setAttribute("nonce",n)}},72:t=>{var n=[];function e(t){for(var e=-1,r=0;r<n.length;r++)if(n[r].identifier===t){e=r;break}return e}function r(t,r){for(var a={},s=[],o=0;o<t.length;o++){var l=t[o],k=r.base?l[0]+r.base:l[0],d=a[k]||0,c="".concat(k," ").concat(d);a[k]=d+1;var p=e(c),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)n[p].references++,n[p].updater(h);else{var u=i(h,r);r.byIndex=o,n.splice(o,0,{identifier:c,updater:u,references:1})}s.push(c)}return s}function i(t,n){var e=n.domAPI(n);return e.update(t),function(n){if(n){if(n.css===t.css&&n.media===t.media&&n.sourceMap===t.sourceMap&&n.supports===t.supports&&n.layer===t.layer)return;e.update(t=n)}else e.remove()}}t.exports=function(t,i){var a=r(t=t||[],i=i||{});return function(t){t=t||[];for(var s=0;s<a.length;s++){var o=e(a[s]);n[o].references--}for(var l=r(t,i),k=0;k<a.length;k++){var d=e(a[k]);0===n[d].references&&(n[d].updater(),n.splice(d,1))}a=l}}},113:t=>{t.exports=function(t,n){if(n.styleSheet)n.styleSheet.cssText=t;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(t))}}},284:(t,n,e)=>{e.d(n,{A:()=>o});var r=e(601),i=e.n(r),a=e(314),s=e.n(a)()(i());s.push([t.id,"/* KI Kraft Widget - Theme Styles */\n\n.kk-widget[data-theme=\"light\"] {\n\t--kk-primary: #3b82f6;\n\t--kk-primary-contrast: #ffffff;\n\t--kk-surface: #ffffff;\n\t--kk-surface-2: #f8fafc;\n\t--kk-border: #e5e7eb;\n\t--kk-text: #111827;\n\t--kk-text-muted: #6b7280;\n\t--kk-focus: 0 0 0 3px rgba(59, 130, 246, 0.35);\n}\n\n.kk-widget[data-theme=\"dark\"] {\n\t--kk-primary: #60a5fa;\n\t--kk-primary-contrast: #0b0f16;\n\t--kk-surface: #0b0f16;\n\t--kk-surface-2: #111827;\n\t--kk-border: #1f2937;\n\t--kk-text: #e5e7eb;\n\t--kk-text-muted: #94a3b8;\n\t--kk-focus: 0 0 0 3px rgba(96, 165, 250, 0.45);\n}\n\n/* Theme toggle button */\n.kk-theme-toggle::before {\n\tcontent: '🌗';\n}\n\n/* Language toggle button */\n.kk-language-toggle::before {\n\tcontent: '🌐';\n}\n",""]);const o=s},314:t=>{t.exports=function(t){var n=[];return n.toString=function(){return this.map(function(n){var e="",r=void 0!==n[5];return n[4]&&(e+="@supports (".concat(n[4],") {")),n[2]&&(e+="@media ".concat(n[2]," {")),r&&(e+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),e+=t(n),r&&(e+="}"),n[2]&&(e+="}"),n[4]&&(e+="}"),e}).join("")},n.i=function(t,e,r,i,a){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(r)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(s[l]=!0)}for(var k=0;k<t.length;k++){var d=[].concat(t[k]);r&&s[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),e&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=e):d[2]=e),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),n.push(d))}},n}},389:(t,n,e)=>{e.d(n,{A:()=>o});var r=e(601),i=e.n(r),a=e(314),s=e.n(a)()(i());s.push([t.id,"/* KI Kraft Widget - Base Styles */\n\n:root {\n\t--kk-primary: #3b82f6;\n\t--kk-primary-contrast: #ffffff;\n\t--kk-surface: #ffffff;\n\t--kk-surface-2: #f8fafc;\n\t--kk-border: #e5e7eb;\n\t--kk-text: #111827;\n\t--kk-text-muted: #6b7280;\n\t--kk-focus: 0 0 0 3px rgba(59, 130, 246, 0.35);\n}\n\n:root[data-theme=\"dark\"] {\n\t--kk-primary: #60a5fa;\n\t--kk-primary-contrast: #0b0f16;\n\t--kk-surface: #0b0f16;\n\t--kk-surface-2: #111827;\n\t--kk-border: #1f2937;\n\t--kk-text: #e5e7eb;\n\t--kk-text-muted: #94a3b8;\n\t--kk-focus: 0 0 0 3px rgba(96, 165, 250, 0.45);\n}\n\n*,\n*::before,\n*::after {\n\tbox-sizing: border-box;\n}\n\n.kk-widget {\n\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n\tfont-size: 14px;\n\tline-height: 1.5;\n\tcolor: var(--kk-text);\n}\n\n@media (prefers-reduced-motion: reduce) {\n\t*,\n\t*::before,\n\t*::after {\n\t\tanimation-duration: 0.01ms !important;\n\t\tanimation-iteration-count: 1 !important;\n\t\ttransition-duration: 0.01ms !important;\n\t}\n}\n",""]);const o=s},540:t=>{t.exports=function(t){var n=document.createElement("style");return t.setAttributes(n,t.attributes),t.insert(n,t.options),n}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var n={};t.exports=function(t,e){var r=function(t){if(void 0===n[t]){var e=document.querySelector(t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}n[t]=e}return n[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=t.insertStyleElement(t);return{update:function(e){!function(t,n,e){var r="";e.supports&&(r+="@supports (".concat(e.supports,") {")),e.media&&(r+="@media ".concat(e.media," {"));var i=void 0!==e.layer;i&&(r+="@layer".concat(e.layer.length>0?" ".concat(e.layer):""," {")),r+=e.css,i&&(r+="}"),e.media&&(r+="}"),e.supports&&(r+="}");var a=e.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(r,t,n.options)}(n,t,e)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)}}}},978:(t,n,e)=>{e.d(n,{A:()=>o});var r=e(601),i=e.n(r),a=e(314),s=e.n(a)()(i());s.push([t.id,"/* KI Kraft Widget - Component Styles */\n\n.kk-message {\n\tmargin-bottom: 12px;\n\tdisplay: flex;\n\tgap: 8px;\n}\n\n.kk-message.user {\n\tjustify-content: flex-end;\n}\n\n.kk-bubble {\n\tmax-width: 90%;\n\tpadding: 10px 14px;\n\tborder-radius: 12px;\n\tword-wrap: break-word;\n\tline-height: 1.5;\n}\n\n.kk-bubble.user {\n\tbackground: transparent;\n\tborder: 1px solid var(--kk-primary);\n\tcolor: var(--kk-text);\n\tborder-radius: 12px 12px 0 12px;\n}\n\n.kk-bubble.bot {\n\tbackground: var(--kk-surface-2);\n\tborder: 1px solid var(--kk-border);\n\tcolor: var(--kk-text);\n\tborder-radius: 12px 12px 12px 0;\n}\n\n.kk-bubble.assistant {\n\tbackground: var(--kk-surface-2);\n\tborder: 1px solid var(--kk-border);\n\tcolor: var(--kk-text);\n\tborder-radius: 12px 12px 12px 0;\n}\n\n.kk-sources {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tgap: 4px;\n\tmargin-top: 8px;\n\tpadding-top: 8px;\n\tborder-top: 1px solid var(--kk-border);\n}\n\n.kk-composer textarea {\n\twidth: 100%;\n\tmin-height: 60px;\n\tpadding: 10px;\n\tborder: 1px solid var(--kk-border);\n\tborder-radius: 8px;\n\tresize: vertical;\n\tfont-family: inherit;\n\tfont-size: inherit;\n\tcolor: var(--kk-text);\n\tbackground: var(--kk-surface);\n}\n\n.kk-composer textarea:focus-visible {\n\toutline: var(--kk-focus);\n}\n\n.kk-button-primary {\n\tbackground: var(--kk-primary);\n\tcolor: var(--kk-primary-contrast);\n\tborder: none;\n\tpadding: 8px 16px;\n\tborder-radius: 8px;\n\tcursor: pointer;\n\tfont-weight: 500;\n\ttransition: filter 0.2s;\n\tfont-size: 14px;\n}\n\n.kk-button-primary:hover {\n\tfilter: brightness(0.95);\n}\n\n.kk-button-primary:focus-visible {\n\toutline: var(--kk-focus);\n}\n\n.kk-badge {\n\tdisplay: inline-block;\n\tpadding: 2px 8px;\n\tbackground: var(--kk-surface-2);\n\tborder: 1px solid var(--kk-border);\n\tborder-radius: 12px;\n\tfont-size: 11px;\n\tcolor: var(--kk-primary);\n\tcursor: help;\n}\n\n.kk-typing-indicator {\n\tdisplay: flex;\n\tjustify-content: flex-start;\n}\n\n.kk-typing-dots {\n\tdisplay: flex;\n\tgap: 4px;\n\tpadding: 4px 0;\n}\n\n.kk-typing-dots span {\n\twidth: 6px;\n\theight: 6px;\n\tbackground: var(--kk-text-muted);\n\tborder-radius: 50%;\n\tanimation: typing 1.4s infinite;\n}\n\n.kk-typing-dots span:nth-child(1) {\n\tanimation-delay: 0s;\n}\n\n.kk-typing-dots span:nth-child(2) {\n\tanimation-delay: 0.2s;\n}\n\n.kk-typing-dots span:nth-child(3) {\n\tanimation-delay: 0.4s;\n}\n\n@keyframes typing {\n\t0%, 60%, 100% {\n\t\ttransform: translateY(0);\n\t\topacity: 0.4;\n\t}\n\t30% {\n\t\ttransform: translateY(-6px);\n\t\topacity: 1;\n\t}\n}\n\n@media (prefers-reduced-motion: reduce) {\n\t@keyframes typing {\n\t\t0%, 100% {\n\t\t\topacity: 0.4;\n\t\t}\n\t\t50% {\n\t\t\topacity: 1;\n\t\t}\n\t}\n\t\n\t.kk-typing-dots span {\n\t\ttransform: none;\n\t}\n}\n\n/* Floating Bubble Styles */\n.kk-floating {\n\tposition: fixed;\n\tbottom: 24px;\n\tz-index: 9999;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-end;\n}\n\n.kk-floating.kk-pos-br {\n\tright: 24px;\n}\n\n.kk-floating.kk-pos-bl {\n\tleft: 24px;\n\talign-items: flex-start;\n}\n\n.kk-floating-bubble {\n\twidth: 60px;\n\theight: 60px;\n\tborder-radius: 50%;\n\tbackground: var(--kk-primary);\n\tcolor: white;\n\tborder: none;\n\tcursor: pointer;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 28px;\n\tbox-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n\ttransition: all 0.3s ease;\n\tanimation: bubble-entrance 0.5s ease;\n}\n\n.kk-floating-bubble:hover {\n\ttransform: scale(1.1);\n\tbox-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\n}\n\n.kk-floating-bubble:active {\n\ttransform: scale(0.95);\n}\n\n@keyframes bubble-entrance {\n\t0% {\n\t\topacity: 0;\n\t\ttransform: scale(0) translateY(20px);\n\t}\n\t100% {\n\t\topacity: 1;\n\t\ttransform: scale(1) translateY(0);\n\t}\n}\n\n.kk-floating .kk-sidebar {\n\tposition: fixed;\n\tbottom: 100px;\n\twidth: 360px;\n\theight: 500px;\n\tmax-height: calc(100vh - 120px);\n\tborder-radius: 12px;\n\tbox-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);\n\ttransform-origin: bottom;\n\tanimation: sidebar-slide-up 0.3s ease;\n}\n\n.kk-floating.kk-pos-br .kk-sidebar {\n\tright: 24px;\n}\n\n.kk-floating.kk-pos-bl .kk-sidebar {\n\tleft: 24px;\n}\n\n@keyframes sidebar-slide-up {\n\t0% {\n\t\topacity: 0;\n\t\ttransform: translateY(20px) scale(0.95);\n\t}\n\t100% {\n\t\topacity: 1;\n\t\ttransform: translateY(0) scale(1);\n\t}\n}\n\n/* Mobile responsive */\n@media (max-width: 640px) {\n\t.kk-floating {\n\t\tbottom: 16px;\n\t}\n\n\t.kk-floating.kk-pos-br,\n\t.kk-floating.kk-pos-bl {\n\t\tright: 16px;\n\t\tleft: auto;\n\t}\n\n\t.kk-floating-bubble {\n\t\twidth: 56px;\n\t\theight: 56px;\n\t\tfont-size: 24px;\n\t}\n\n\t.kk-floating .kk-sidebar {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\twidth: 100%;\n\t\theight: calc(100vh - 80px);\n\t\tmax-height: none;\n\t\tborder-radius: 12px 12px 0 0;\n\t}\n}\n\n/* Login Prompt */\n.kk-login-prompt {\n\tpadding: 32px;\n\ttext-align: center;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tgap: 16px;\n\theight: 100%;\n}\n\n.kk-login-prompt p {\n\tmargin: 0;\n\tcolor: var(--kk-text);\n\tfont-size: 16px;\n}\n\n.kk-login-prompt .kk-btn {\n\tpadding: 12px 24px;\n\tbackground: var(--kk-primary);\n\tcolor: white;\n\tborder: none;\n\tborder-radius: 8px;\n\ttext-decoration: none;\n\tfont-weight: 500;\n\ttransition: all 0.2s ease;\n\tdisplay: inline-block;\n}\n\n.kk-login-prompt .kk-btn:hover {\n\tbackground: var(--kk-primary);\n\tfilter: brightness(1.1);\n\ttransform: translateY(-1px);\n}\n",""]);const o=s}},n={};function e(r){var i=n[r];if(void 0!==i)return i.exports;var a=n[r]={id:r,exports:{}};return t[r](a,a.exports,e),a.exports}e.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},e.d=(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),e.nc=void 0;var r=e(72),i=e.n(r),a=e(825),s=e.n(a),o=e(659),l=e.n(o),k=e(56),d=e.n(k),c=e(540),p=e.n(c),h=e(113),u=e.n(h),g=e(389),f={};f.styleTagTransform=u(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=s(),f.insertStyleElement=p(),i()(g.A,f),g.A&&g.A.locals&&g.A.locals;var b=e(40),m={};m.styleTagTransform=u(),m.setAttributes=d(),m.insert=l().bind(null,"head"),m.domAPI=s(),m.insertStyleElement=p(),i()(b.A,m),b.A&&b.A.locals&&b.A.locals;var x=e(978),v={};v.styleTagTransform=u(),v.setAttributes=d(),v.insert=l().bind(null,"head"),v.domAPI=s(),v.insertStyleElement=p(),i()(x.A,v),x.A&&x.A.locals&&x.A.locals;var y=e(284),w={};w.styleTagTransform=u(),w.setAttributes=d(),w.insert=l().bind(null,"head"),w.domAPI=s(),w.insertStyleElement=p(),i()(y.A,w),y.A&&y.A.locals&&y.A.locals,window.kraftAIChatConfig=window.kraftAIChatConfig||{},window.kraftAIChatConfig.apiUrl=window.kraftAIChatConfig.apiUrl||"",window.kraftAIChatConfig.nonce=window.kraftAIChatConfig.nonce||"",window.kraftAIChatConfig.version=window.kraftAIChatConfig.version||"1.0.0",window.kraftAIChatConfig.branding=window.kraftAIChatConfig.branding||{},window.kraftAIChatConfig.settings=window.kraftAIChatConfig.settings||{general:{},accounts:{}},window.kraftAIChatConfig.user=window.kraftAIChatConfig.user||{loggedIn:!1},window.kraftAIChatConfig.i18n=window.kraftAIChatConfig.i18n||{send:"Send",typing:"Typing...",placeholder:"Type your message...",close:"Close"};const C={product_name:"Chat Assistant",primary_color:"#2563eb",secondary_color:"#60a5fa",theme:"auto",icon_color:"#2563eb",header_text_color:"#111827",faq_header_title:"Häufige Fragen",advisor_header_title:"Mitglieder-Chat",...window.kraftAIChatConfig.branding};window.kraftAIChatBranding=C,window.KIKraftConfig=window.kraftAIChatConfig;class S{constructor(){this.container=null,this.railOpen=!1,this.sidebarOpen=!1,this.messages=[],this.sessionId=null,this.isTyping=!1,this.isFloating=!1,this.sessions=[],this.currentSessionId=null,this.init()}init(){if(document.querySelector(".kk-widget.kk-initialized"))return;const t=document.querySelectorAll(".kk-widget");0!==t.length&&t.forEach(t=>{this.container=t,this.isFloating=this.container.classList.contains("kk-floating"),this.container.classList.add("kk-initialized"),this.render()})}render(){if(!this.container)return;const t=this.container.getAttribute("data-type")||"faq",n=window.kraftAIChatConfig;"member"!==t||n.user.loggedIn?"member"!==t||this.isFloating?(this.isFloating?this.renderFloating(t):this.renderRegular(t),this.attachEventListeners(),this.restoreState()):this.renderFullscreen():this.renderLoginPrompt()}renderFloating(t){if(!this.container)return;const n=window.kraftAIChatBranding,e=window.kraftAIChatConfig;this.container.innerHTML=`\n\t\t\t<button class="kk-floating-bubble" aria-label="Open chat" title="Chat">\n\t\t\t\t💬\n\t\t\t</button>\n\t\t\t\n\t\t\t<div class="kk-sidebar" data-theme="light" style="display: none;">\n\t\t\t\t<div class="kk-sidebar__header">\n\t\t\t\t\t<div class="kk-header-info">\n\t\t\t\t\t\t<strong>${n.product_name}</strong>\n\t\t\t\t\t\t<span class="kk-type-badge">${t.toUpperCase()}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class="kk-close-btn" aria-label="Close">✕</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="kk-chat" role="log" aria-live="polite">\n\t\t\t\t\t<div class="kk-messages"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="kk-composer">\n\t\t\t\t\t<textarea \n\t\t\t\t\t\tclass="kk-input" \n\t\t\t\t\t\tplaceholder="${e.i18n.placeholder}"\n\t\t\t\t\t\trows="1"\n\t\t\t\t\t></textarea>\n\t\t\t\t\t<button class="kk-button-primary kk-send-btn">${e.i18n.send}</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}renderRegular(t){if(!this.container)return;const n=window.kraftAIChatBranding,e=window.kraftAIChatConfig;this.container.innerHTML=`\n\t\t\t<div class="kk-rail" data-theme="light">\n\t\t\t\t${e.user.loggedIn&&e.user.avatarUrl?`<img src="${e.user.avatarUrl}" class="kk-rail-avatar" alt="User" />`:'<div class="kk-rail-avatar-placeholder">?</div>'}\n\t\t\t\t<button class="kk-rail-btn kk-chat-btn" aria-label="Open chat" title="Chat">\n\t\t\t\t\t💬\n\t\t\t\t</button>\n\t\t\t\t<button class="kk-rail-btn kk-theme-toggle" aria-label="Toggle theme" title="Theme">\n\t\t\t\t\t🌗\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="kk-sidebar" data-theme="light">\n\t\t\t\t<div class="kk-sidebar__header">\n\t\t\t\t\t<div class="kk-header-info">\n\t\t\t\t\t\t<strong>${n.product_name}</strong>\n\t\t\t\t\t\t<span class="kk-type-badge">${t.toUpperCase()}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class="kk-close-btn" aria-label="Close">✕</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="kk-chat" role="log" aria-live="polite">\n\t\t\t\t\t<div class="kk-messages"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="kk-composer">\n\t\t\t\t\t<textarea \n\t\t\t\t\t\tclass="kk-input" \n\t\t\t\t\t\tplaceholder="${e.i18n.placeholder}"\n\t\t\t\t\t\trows="1"\n\t\t\t\t\t></textarea>\n\t\t\t\t\t<button class="kk-button-primary kk-send-btn">${e.i18n.send}</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}renderFullscreen(){if(!this.container)return;const t=window.kraftAIChatBranding,n=window.kraftAIChatConfig,e=localStorage.getItem("kk_theme")||"light",r="false"!==localStorage.getItem("kk_member_sidebar_open");this.container.innerHTML=`\n\t\t\t<div class="kk-fullscreen" role="application" aria-label="Mitglieder-Chat">\n\t\t\t\t<aside class="kk-rail" data-theme="${e}" aria-label="Navigation">\n\t\t\t\t\t${n.user.loggedIn&&n.user.avatarUrl?`<img src="${n.user.avatarUrl}" class="kk-rail-avatar" alt="${n.user.displayName||"User"}" />`:'<div class="kk-rail-btn kk-rail-avatar" title="Profil">👤</div>'}\n\t\t\t\t\t<button class="kk-rail-btn kk-rail-new" title="Neue Unterhaltung">＋</button>\n\t\t\t\t\t<button class="kk-rail-btn kk-rail-collapse" title="Seitenleiste ein-/ausklappen">❮</button>\n\t\t\t\t\t<button class="kk-rail-btn kk-rail-search" title="Suchen">🔎</button>\n\t\t\t\t\t<div class="kk-rail-lang" aria-label="Sprache">EN</div>\n\t\t\t\t\t<button class="kk-rail-btn kk-rail-settings" title="Einstellungen">⚙️</button>\n\t\t\t\t</aside>\n\n\t\t\t\t<section class="kk-sidebar ${r?"open":""}" data-theme="${e}" aria-label="Chatbereich">\n\t\t\t\t\t<header class="kk-sidebar__header">\n\t\t\t\t\t\t<div class="kk-header-left">\n\t\t\t\t\t\t\t<div class="kk-brand">\n\t\t\t\t\t\t\t\t${t.logo_url?`<img class="kk-brand-logo" src="${t.logo_url}" alt="${t.product_name}" />`:""}\n\t\t\t\t\t\t\t\t<span class="kk-brand-title">${t.advisor_header_title||"Berater-Chat"}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="kk-conv-title"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="kk-header-actions">\n\t\t\t\t\t\t\t<button class="kk-header-close" aria-label="Schließen">✕</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</header>\n\n\t\t\t\t\t<div class="kk-body">\n\t\t\t\t\t\t<nav class="kk-history" aria-label="Conversations">\n\t\t\t\t\t\t\t<div class="kk-history-search">\n\t\t\t\t\t\t\t\t<input type="search" class="kk-history-search-input" placeholder="Search..." />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button class="kk-new-chat-btn">+ New Chat</button>\n\t\t\t\t\t\t\t<div class="kk-history-list">\n\t\t\t\t\t\t\t\t\x3c!-- Conversation items will be rendered here --\x3e\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</nav>\n\n\t\t\t\t\t\t<main class="kk-chat" role="log" aria-live="polite" aria-relevant="additions">\n\t\t\t\t\t\t\t<div class="kk-messages">\n\t\t\t\t\t\t\t\t\x3c!-- Messages will be rendered here --\x3e\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</main>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<footer class="kk-composer">\n\t\t\t\t\t\t<button class="kk-mic-btn" aria-label="Spracheingabe">🎤</button>\n\t\t\t\t\t\t<textarea class="kk-input" rows="1" placeholder="Nachricht schreiben..."></textarea>\n\t\t\t\t\t\t<button class="kk-send-btn" aria-label="Senden">✈️</button>\n\t\t\t\t\t</footer>\n\n\t\t\t\t\t<div class="kk-legal">\n\t\t\t\t\t\t<span class="kk-legal-text">${t.footer_text||""}</span>\n\t\t\t\t\t\t${t.privacy_url?`<a class="kk-legal-link" href="${t.privacy_url}">Datenschutzerklärung</a>`:""}\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t</div>\n\t\t`,this.sidebarOpen=r,this.attachEventListeners(),this.loadSessions()}renderLoginPrompt(){if(!this.container)return;const t=(window.kraftAIChatConfig.settings||{}).accounts||{};let n="/wp-login.php";t.profile_url_override?n=t.profile_url_override:t.profile_url?n=t.profile_url:t.account_page_id&&(n="/account/"),this.isFloating?this.container.innerHTML=`\n\t\t\t\t<button class="kk-floating-bubble" aria-label="Login required" title="Login">\n\t\t\t\t\t💬\n\t\t\t\t</button>\n\t\t\t\t<div class="kk-sidebar" data-theme="light" style="display: none;">\n\t\t\t\t\t<div class="kk-sidebar__header">\n\t\t\t\t\t\t<div class="kk-header-info">\n\t\t\t\t\t\t\t<strong>Mitglieder-Chat</strong>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button class="kk-close-btn" aria-label="Close">✕</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="kk-login-prompt">\n\t\t\t\t\t\t<h3>Mitglieder-Chat</h3>\n\t\t\t\t\t\t<p>Bitte melde dich an, um den Mitglieder-Chat zu nutzen.</p>\n\t\t\t\t\t\t<a href="${n}" class="kk-btn">Jetzt einloggen</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`:this.container.innerHTML=`\n\t\t\t\t<div class="kk-login-prompt">\n\t\t\t\t\t<h3>Mitglieder-Chat</h3>\n\t\t\t\t\t<p>Bitte melde dich an, um den Mitglieder-Chat zu nutzen.</p>\n\t\t\t\t\t<a href="${n}" class="kk-btn">Jetzt einloggen</a>\n\t\t\t\t</div>\n\t\t\t`;const e=this.container.querySelector(".kk-close-btn"),r=this.container.querySelector(".kk-floating-bubble");e&&e.addEventListener("click",()=>this.toggleSidebar()),r&&r.addEventListener("click",()=>this.toggleSidebar())}restoreState(){this.isFloating&&"true"===localStorage.getItem("kraft_ai_chat_open")&&this.openSidebar()}saveState(){this.isFloating&&localStorage.setItem("kraft_ai_chat_open",this.sidebarOpen.toString())}attachEventListeners(){if(!this.container)return;const t=this.container.querySelector(".kk-floating-bubble");t&&t.addEventListener("click",()=>this.toggleSidebar());const n=this.container.querySelector(".kk-chat-btn"),e=this.container.querySelector(".kk-theme-toggle"),r=this.container.querySelector(".kk-close-btn"),i=this.container.querySelector(".kk-send-btn"),a=this.container.querySelector(".kk-input");n?.addEventListener("click",()=>this.toggleSidebar()),r?.addEventListener("click",()=>this.toggleSidebar()),e?.addEventListener("click",()=>this.toggleTheme()),i?.addEventListener("click",()=>this.sendMessage()),a?.addEventListener("keydown",t=>{"Enter"===t.key&&(t.ctrlKey||t.metaKey)&&this.sendMessage()});const s=this.container.querySelector(".kk-rail-new"),o=this.container.querySelector(".kk-rail-collapse"),l=this.container.querySelector(".kk-rail-settings"),k=this.container.querySelector(".kk-header-close"),d=this.container.querySelector(".kk-new-chat-btn"),c=this.container.querySelector(".kk-mic-btn");s?.addEventListener("click",()=>this.createNewChat()),o?.addEventListener("click",()=>this.toggleFullscreenSidebar()),l?.addEventListener("click",()=>this.toggleTheme()),k?.addEventListener("click",()=>this.closeFullscreen()),d?.addEventListener("click",()=>this.createNewChat()),c?.addEventListener("click",()=>this.handleVoiceInput());const p=this.container.querySelector(".kk-history-list");p?.addEventListener("click",t=>{const n=t.target,e=n.closest(".kk-history-item");if(n.closest(".kk-history-rename")){t.stopPropagation();const n=e?.getAttribute("data-session-id");n&&this.renameSession(n)}else if(n.closest(".kk-history-delete")){t.stopPropagation();const n=e?.getAttribute("data-session-id");n&&this.deleteSession(n)}else if(e){const t=e.getAttribute("data-session-id");t&&this.loadSession(t)}}),document.addEventListener("keydown",t=>{"Escape"===t.key&&(this.container?.querySelector(".kk-fullscreen")?this.closeFullscreen():this.sidebarOpen&&this.toggleSidebar())})}toggleSidebar(){this.container&&this.container.querySelector(".kk-sidebar")&&(this.sidebarOpen=!this.sidebarOpen,this.sidebarOpen?this.openSidebar():this.closeSidebar(),this.saveState())}openSidebar(){if(!this.container)return;const t=this.container.querySelector(".kk-sidebar");t&&(this.sidebarOpen=!0,this.isFloating?(t.style.display="flex",t.offsetHeight,t.classList.add("open")):t.classList.add("open"),!this.sessionId&&window.kraftAIChatConfig.user.loggedIn&&this.createSession())}closeSidebar(){if(!this.container)return;const t=this.container.querySelector(".kk-sidebar");t&&(this.sidebarOpen=!1,t.classList.remove("open"),this.isFloating&&setTimeout(()=>{t.style.display="none"},300))}toggleTheme(){if(!this.container)return;const t=this.container.querySelector(".kk-rail"),n=this.container.querySelector(".kk-sidebar"),e="light"===(t?.getAttribute("data-theme")||"light")?"dark":"light";t?.setAttribute("data-theme",e),n?.setAttribute("data-theme",e),localStorage.setItem("kk_theme",e)}toggleFullscreenSidebar(){if(!this.container)return;const t=this.container.querySelector(".kk-sidebar");t&&(this.sidebarOpen=!this.sidebarOpen,this.sidebarOpen?t.classList.add("open"):t.classList.remove("open"),localStorage.setItem("kk_member_sidebar_open",this.sidebarOpen.toString()))}closeFullscreen(){this.container&&this.container.querySelector(".kk-fullscreen")&&(this.container.style.display="none")}handleVoiceInput(){console.log("Voice input not yet implemented")}async loadSessions(){if(window.kraftAIChatConfig.apiUrl)try{const t=await fetch(`${window.kraftAIChatConfig.apiUrl}/member/sessions`,{method:"GET",headers:{"X-WP-Nonce":window.kraftAIChatConfig.nonce}});if(!t.ok)return void console.error("Failed to load sessions");const n=await t.json();this.sessions=n.success&&n.data||[],this.renderSessions()}catch(t){console.error("Error loading sessions:",t)}}renderSessions(){if(!this.container)return;const t=this.container.querySelector(".kk-history-list");t&&(0!==this.sessions.length?t.innerHTML=this.sessions.map(t=>`\n\t\t\t<div class="kk-history-item ${t.session_id===this.currentSessionId?"active":""}" data-session-id="${t.session_id}">\n\t\t\t\t<span class="kk-history-title">${this.escapeHtml(t.title||"Untitled")}</span>\n\t\t\t\t<div class="kk-history-actions">\n\t\t\t\t\t<button class="kk-history-rename" title="Umbenennen">✎</button>\n\t\t\t\t\t<button class="kk-history-delete" title="Löschen">🗑</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`).join(""):t.innerHTML='<div style="text-align:center;color:var(--kk-text-muted);padding:20px;">No conversations yet</div>')}async createNewChat(){try{const t=await fetch(`${window.kraftAIChatConfig.apiUrl}/member/session`,{method:"POST",headers:{"X-WP-Nonce":window.kraftAIChatConfig.nonce}});if(!t.ok)return void console.error("Failed to create session");const n=await t.json();if(n.success&&n.data.session_id){this.sessionId=n.data.session_id,this.currentSessionId=n.data.session_id,this.messages=[],await this.loadSessions(),this.renderMessages();const t=this.container?.querySelector(".kk-input");t?.focus()}}catch(t){console.error("Error creating new chat:",t)}}async loadSession(t){if(window.kraftAIChatConfig.apiUrl)try{const n=await fetch(`${window.kraftAIChatConfig.apiUrl}/member/session/${t}/messages`,{method:"GET",headers:{"X-WP-Nonce":window.kraftAIChatConfig.nonce}});if(!n.ok)return void console.error("Failed to load session messages");const e=await n.json();e.success&&(this.currentSessionId=t,this.sessionId=t,this.messages=e.data||[],this.renderSessions(),this.renderMessages())}catch(t){console.error("Error loading session:",t)}}async renameSession(t){const n=this.sessions.find(n=>n.session_id===t),e=prompt("Neuer Titel:",n?.title||"");if(e&&e!==n?.title)try{(await fetch(`${window.kraftAIChatConfig.apiUrl}/member/session/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-WP-Nonce":window.kraftAIChatConfig.nonce},body:JSON.stringify({title:e})})).ok&&await this.loadSessions()}catch(t){console.error("Error renaming session:",t)}}async deleteSession(t){if(confirm("Diese Unterhaltung wirklich löschen?"))try{(await fetch(`${window.kraftAIChatConfig.apiUrl}/member/session/${t}`,{method:"DELETE",headers:{"X-WP-Nonce":window.kraftAIChatConfig.nonce}})).ok&&(this.currentSessionId===t&&(this.currentSessionId=null,this.sessionId=null,this.messages=[],this.renderMessages()),await this.loadSessions())}catch(t){console.error("Error deleting session:",t)}}escapeHtml(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}async createSession(){if(window.kraftAIChatConfig.apiUrl&&window.kraftAIChatConfig.nonce)try{const t=await fetch(`${window.kraftAIChatConfig.apiUrl}/member/session`,{method:"POST",headers:{"X-WP-Nonce":window.kraftAIChatConfig.nonce}}),n=await t.json();this.sessionId=n.session_id}catch(t){console.error("Failed to create session:",t)}else console.error("Failed to create session: Missing API configuration")}async sendMessage(){if(!this.container)return;const t=this.container.querySelector(".kk-input"),n=t.value.trim();if(n){if(!window.kraftAIChatConfig.apiUrl||!window.kraftAIChatConfig.nonce)return console.error("Failed to send message: Missing API configuration"),void this.addMessage({role:"assistant",content:"Configuration error: Unable to connect to chat service."});t.value="",this.addMessage({role:"user",content:n}),this.isTyping=!0,this.renderTypingIndicator();try{const t=this.container.getAttribute("data-type")||"faq";let e="",r={};"member"===t&&this.sessionId?(e="/member/message",r={session_id:this.sessionId,message:n}):(e="/faq/query",r={query:n});const i=await fetch(`${window.kraftAIChatConfig.apiUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.kraftAIChatConfig.nonce},body:JSON.stringify(r)}),a=await i.json();this.isTyping=!1,this.removeTypingIndicator(),(a.answer||a.response)&&this.addMessage({role:"assistant",content:a.answer||a.response,sources:a.sources})}catch(t){console.error("Failed to send message:",t),this.isTyping=!1,this.removeTypingIndicator(),this.addMessage({role:"assistant",content:"Sorry, there was an error processing your request."})}}}addMessage(t){this.messages.push(t),this.renderMessages()}renderMessages(){if(!this.container)return;const t=this.container.querySelector(".kk-messages");if(!t)return;const n=!!this.container.querySelector(".kk-fullscreen");t.innerHTML=this.messages.map((t,e)=>{const r=t.sources&&t.sources.length>0?`<div class="kk-sources">\n\t\t\t\t\t\t\t${t.sources.map(t=>`<span class="kk-badge" title="Score: ${t.score}">${t.title}</span>`).join("")}\n\t\t\t\t\t\t</div>`:"",i=n&&"assistant"===t.role&&e===this.messages.length-1?`<div class="kk-message-actions">\n\t\t\t\t\t\t<button class="kk-msg-copy" title="Kopieren" data-msg-index="${e}">📋</button>\n\t\t\t\t\t\t<button class="kk-msg-retry" title="Neu generieren" data-msg-index="${e}">🔄</button>\n\t\t\t\t\t\t<button class="kk-msg-like" title="Gefällt mir" data-msg-index="${e}">👍</button>\n\t\t\t\t\t\t<button class="kk-msg-dislike" title="Gefällt mir nicht" data-msg-index="${e}">👎</button>\n\t\t\t\t\t\t<button class="kk-msg-delete" title="Löschen" data-msg-index="${e}">🗑</button>\n\t\t\t\t\t</div>`:"";return n?`\n\t\t\t\t\t\t<div class="kk-message ${t.role}">\n\t\t\t\t\t\t\t<div class="kk-message-content">\n\t\t\t\t\t\t\t\t${t.content}\n\t\t\t\t\t\t\t\t${r}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`:`\n\t\t\t\t\t\t<div class="kk-message ${t.role}">\n\t\t\t\t\t\t\t<div class="kk-bubble ${t.role}">\n\t\t\t\t\t\t\t\t${t.content}\n\t\t\t\t\t\t\t\t${r}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`}).join(""),n&&(t.querySelectorAll(".kk-msg-copy").forEach(t=>{t.addEventListener("click",t=>{const n=parseInt(t.target.dataset.msgIndex||"0");this.copyMessage(n)})}),t.querySelectorAll(".kk-msg-retry").forEach(t=>{t.addEventListener("click",()=>this.retryLastMessage())}),t.querySelectorAll(".kk-msg-like, .kk-msg-dislike").forEach(t=>{t.addEventListener("click",t=>{const n=parseInt(t.target.dataset.msgIndex||"0"),e=t.target.classList.contains("kk-msg-like");this.rateMessage(n,e)})}),t.querySelectorAll(".kk-msg-delete").forEach(t=>{t.addEventListener("click",t=>{const n=parseInt(t.target.dataset.msgIndex||"0");this.deleteMessage(n)})}));const e=this.container.querySelector(".kk-chat");e&&(e.scrollTop=e.scrollHeight)}copyMessage(t){const n=this.messages[t];n&&navigator.clipboard.writeText(n.content).then(()=>{console.log("Message copied to clipboard")}).catch(t=>{console.error("Failed to copy:",t)})}retryLastMessage(){for(let t=this.messages.length-1;t>=0;t--)if("user"===this.messages[t].role){const n=this.container?.querySelector(".kk-input");n&&(n.value=this.messages[t].content,this.sendMessage());break}}rateMessage(t,n){console.log(`Message ${t} rated:`,n?"like":"dislike")}deleteMessage(t){confirm("Diese Nachricht wirklich löschen?")&&(this.messages.splice(t,1),this.renderMessages())}renderTypingIndicator(){if(!this.container)return;const t=this.container.querySelector(".kk-messages");if(!t)return;const n=document.createElement("div");n.className="kk-typing-indicator",n.innerHTML='\n\t\t\t<div class="kk-bubble bot">\n\t\t\t\t<span class="kk-typing-dots">\n\t\t\t\t\t<span></span><span></span><span></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t',t.appendChild(n);const e=this.container.querySelector(".kk-chat");e&&(e.scrollTop=e.scrollHeight)}removeTypingIndicator(){if(!this.container)return;const t=this.container.querySelector(".kk-typing-indicator");t?.remove()}}function I(){new S}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",I):I()})();