(()=>{"use strict";var t={40:(t,n,e)=>{e.d(n,{A:()=>o});var r=e(601),a=e.n(r),i=e(314),s=e.n(i)()(a());s.push([t.id,"/* KI Kraft Widget - Layout Styles */\n\n.kk-rail {\n\tposition: fixed;\n\tright: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\twidth: 36px;\n\tbackground: var(--kk-surface);\n\tborder: 1px solid var(--kk-border);\n\tborder-right: none;\n\tborder-radius: 8px 0 0 8px;\n\tpadding: 8px 4px;\n\tz-index: 9998;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8px;\n\talign-items: center;\n}\n\n.kk-rail-btn {\n\twidth: 28px;\n\theight: 28px;\n\tborder: none;\n\tbackground: transparent;\n\tcolor: var(--kk-primary);\n\tborder-radius: 8px;\n\tcursor: pointer;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\ttransition: filter 0.2s;\n\tfont-size: 16px;\n}\n\n.kk-rail-btn:hover {\n\tfilter: brightness(0.95);\n\tbackground: var(--kk-surface-2);\n}\n\n.kk-rail-btn:focus-visible {\n\toutline: var(--kk-focus);\n}\n\n.kk-rail-avatar {\n\twidth: 28px;\n\theight: 28px;\n\tborder-radius: 50%;\n\toverflow: hidden;\n\tcursor: pointer;\n\tborder: 2px solid var(--kk-border);\n}\n\n.kk-rail-avatar-placeholder {\n\twidth: 28px;\n\theight: 28px;\n\tborder-radius: 50%;\n\tbackground: var(--kk-primary);\n\tcolor: var(--kk-primary-contrast);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-weight: bold;\n\tcursor: pointer;\n}\n\n.kk-sidebar {\n\tposition: fixed;\n\tright: 0;\n\ttop: 0;\n\twidth: 360px;\n\theight: 100vh;\n\tbackground: var(--kk-surface);\n\tborder-left: 1px solid var(--kk-border);\n\tz-index: 9999;\n\ttransform: translateX(100%);\n\ttransition: transform 0.3s ease;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbox-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);\n}\n\n.kk-sidebar.open {\n\ttransform: translateX(0);\n}\n\n.kk-sidebar__header {\n\tpadding: 16px;\n\tborder-bottom: 1px solid var(--kk-border);\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tbackground: var(--kk-surface-2);\n}\n\n.kk-header-info {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 4px;\n}\n\n.kk-type-badge {\n\tfont-size: 10px;\n\tcolor: var(--kk-text-muted);\n\ttext-transform: uppercase;\n\tletter-spacing: 0.5px;\n}\n\n.kk-close-btn {\n\twidth: 28px;\n\theight: 28px;\n\tborder: none;\n\tbackground: transparent;\n\tcolor: var(--kk-text-muted);\n\tborder-radius: 4px;\n\tcursor: pointer;\n\tfont-size: 20px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\ttransition: all 0.2s;\n}\n\n.kk-close-btn:hover {\n\tbackground: var(--kk-border);\n\tcolor: var(--kk-text);\n}\n\n.kk-chat {\n\tflex: 1;\n\toverflow-y: auto;\n\tpadding: 16px;\n\tbackground: var(--kk-surface);\n}\n\n.kk-messages {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n}\n\n.kk-composer {\n\tpadding: 16px;\n\tborder-top: 1px solid var(--kk-border);\n\tdisplay: flex;\n\tgap: 8px;\n\tbackground: var(--kk-surface-2);\n}\n\n.kk-input {\n\tflex: 1;\n\tpadding: 10px;\n\tborder: 1px solid var(--kk-border);\n\tborder-radius: 8px;\n\tresize: none;\n\tfont-family: inherit;\n\tfont-size: 14px;\n\tcolor: var(--kk-text);\n\tbackground: var(--kk-surface);\n\tmax-height: 120px;\n}\n\n.kk-input:focus {\n\toutline: var(--kk-focus);\n}\n\n.kk-send-btn {\n\talign-self: flex-end;\n\tpadding: 10px 16px;\n\twhite-space: nowrap;\n}\n\n@media (max-width: 640px) {\n\t.kk-sidebar {\n\t\twidth: 100%;\n\t}\n\t\n\t.kk-rail-btn {\n\t\twidth: 44px;\n\t\theight: 44px;\n\t}\n\t\n\t.kk-rail-avatar,\n\t.kk-rail-avatar-placeholder {\n\t\twidth: 44px;\n\t\theight: 44px;\n\t}\n}\n",""]);const o=s},56:(t,n,e)=>{t.exports=function(t){var n=e.nc;n&&t.setAttribute("nonce",n)}},72:t=>{var n=[];function e(t){for(var e=-1,r=0;r<n.length;r++)if(n[r].identifier===t){e=r;break}return e}function r(t,r){for(var i={},s=[],o=0;o<t.length;o++){var d=t[o],l=r.base?d[0]+r.base:d[0],c=i[l]||0,k="".concat(l," ").concat(c);i[l]=c+1;var p=e(k),u={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==p)n[p].references++,n[p].updater(u);else{var b=a(u,r);r.byIndex=o,n.splice(o,0,{identifier:k,updater:b,references:1})}s.push(k)}return s}function a(t,n){var e=n.domAPI(n);return e.update(t),function(n){if(n){if(n.css===t.css&&n.media===t.media&&n.sourceMap===t.sourceMap&&n.supports===t.supports&&n.layer===t.layer)return;e.update(t=n)}else e.remove()}}t.exports=function(t,a){var i=r(t=t||[],a=a||{});return function(t){t=t||[];for(var s=0;s<i.length;s++){var o=e(i[s]);n[o].references--}for(var d=r(t,a),l=0;l<i.length;l++){var c=e(i[l]);0===n[c].references&&(n[c].updater(),n.splice(c,1))}i=d}}},113:t=>{t.exports=function(t,n){if(n.styleSheet)n.styleSheet.cssText=t;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(t))}}},284:(t,n,e)=>{e.d(n,{A:()=>o});var r=e(601),a=e.n(r),i=e(314),s=e.n(i)()(a());s.push([t.id,"/* KI Kraft Widget - Theme Styles */\n\n.kk-widget[data-theme=\"light\"] {\n\t--kk-primary: #3b82f6;\n\t--kk-primary-contrast: #ffffff;\n\t--kk-surface: #ffffff;\n\t--kk-surface-2: #f8fafc;\n\t--kk-border: #e5e7eb;\n\t--kk-text: #111827;\n\t--kk-text-muted: #6b7280;\n\t--kk-focus: 0 0 0 3px rgba(59, 130, 246, 0.35);\n}\n\n.kk-widget[data-theme=\"dark\"] {\n\t--kk-primary: #60a5fa;\n\t--kk-primary-contrast: #0b0f16;\n\t--kk-surface: #0b0f16;\n\t--kk-surface-2: #111827;\n\t--kk-border: #1f2937;\n\t--kk-text: #e5e7eb;\n\t--kk-text-muted: #94a3b8;\n\t--kk-focus: 0 0 0 3px rgba(96, 165, 250, 0.45);\n}\n\n/* Theme toggle button */\n.kk-theme-toggle::before {\n\tcontent: '🌗';\n}\n\n/* Language toggle button */\n.kk-language-toggle::before {\n\tcontent: '🌐';\n}\n",""]);const o=s},314:t=>{t.exports=function(t){var n=[];return n.toString=function(){return this.map(function(n){var e="",r=void 0!==n[5];return n[4]&&(e+="@supports (".concat(n[4],") {")),n[2]&&(e+="@media ".concat(n[2]," {")),r&&(e+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),e+=t(n),r&&(e+="}"),n[2]&&(e+="}"),n[4]&&(e+="}"),e}).join("")},n.i=function(t,e,r,a,i){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(r)for(var o=0;o<this.length;o++){var d=this[o][0];null!=d&&(s[d]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);r&&s[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),e&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=e):c[2]=e),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),n.push(c))}},n}},389:(t,n,e)=>{e.d(n,{A:()=>o});var r=e(601),a=e.n(r),i=e(314),s=e.n(i)()(a());s.push([t.id,"/* KI Kraft Widget - Base Styles */\n\n:root {\n\t--kk-primary: #3b82f6;\n\t--kk-primary-contrast: #ffffff;\n\t--kk-surface: #ffffff;\n\t--kk-surface-2: #f8fafc;\n\t--kk-border: #e5e7eb;\n\t--kk-text: #111827;\n\t--kk-text-muted: #6b7280;\n\t--kk-focus: 0 0 0 3px rgba(59, 130, 246, 0.35);\n}\n\n:root[data-theme=\"dark\"] {\n\t--kk-primary: #60a5fa;\n\t--kk-primary-contrast: #0b0f16;\n\t--kk-surface: #0b0f16;\n\t--kk-surface-2: #111827;\n\t--kk-border: #1f2937;\n\t--kk-text: #e5e7eb;\n\t--kk-text-muted: #94a3b8;\n\t--kk-focus: 0 0 0 3px rgba(96, 165, 250, 0.45);\n}\n\n*,\n*::before,\n*::after {\n\tbox-sizing: border-box;\n}\n\n.kk-widget {\n\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n\tfont-size: 14px;\n\tline-height: 1.5;\n\tcolor: var(--kk-text);\n}\n\n@media (prefers-reduced-motion: reduce) {\n\t*,\n\t*::before,\n\t*::after {\n\t\tanimation-duration: 0.01ms !important;\n\t\tanimation-iteration-count: 1 !important;\n\t\ttransition-duration: 0.01ms !important;\n\t}\n}\n",""]);const o=s},540:t=>{t.exports=function(t){var n=document.createElement("style");return t.setAttributes(n,t.attributes),t.insert(n,t.options),n}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var n={};t.exports=function(t,e){var r=function(t){if(void 0===n[t]){var e=document.querySelector(t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}n[t]=e}return n[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=t.insertStyleElement(t);return{update:function(e){!function(t,n,e){var r="";e.supports&&(r+="@supports (".concat(e.supports,") {")),e.media&&(r+="@media ".concat(e.media," {"));var a=void 0!==e.layer;a&&(r+="@layer".concat(e.layer.length>0?" ".concat(e.layer):""," {")),r+=e.css,a&&(r+="}"),e.media&&(r+="}"),e.supports&&(r+="}");var i=e.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),n.styleTagTransform(r,t,n.options)}(n,t,e)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)}}}},978:(t,n,e)=>{e.d(n,{A:()=>o});var r=e(601),a=e.n(r),i=e(314),s=e.n(i)()(a());s.push([t.id,"/* KI Kraft Widget - Component Styles */\n\n.kk-message {\n\tmargin-bottom: 12px;\n\tdisplay: flex;\n\tgap: 8px;\n}\n\n.kk-message.user {\n\tjustify-content: flex-end;\n}\n\n.kk-bubble {\n\tmax-width: 90%;\n\tpadding: 10px 14px;\n\tborder-radius: 12px;\n\tword-wrap: break-word;\n\tline-height: 1.5;\n}\n\n.kk-bubble.user {\n\tbackground: transparent;\n\tborder: 1px solid var(--kk-primary);\n\tcolor: var(--kk-text);\n\tborder-radius: 12px 12px 0 12px;\n}\n\n.kk-bubble.bot {\n\tbackground: var(--kk-surface-2);\n\tborder: 1px solid var(--kk-border);\n\tcolor: var(--kk-text);\n\tborder-radius: 12px 12px 12px 0;\n}\n\n.kk-bubble.assistant {\n\tbackground: var(--kk-surface-2);\n\tborder: 1px solid var(--kk-border);\n\tcolor: var(--kk-text);\n\tborder-radius: 12px 12px 12px 0;\n}\n\n.kk-sources {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tgap: 4px;\n\tmargin-top: 8px;\n\tpadding-top: 8px;\n\tborder-top: 1px solid var(--kk-border);\n}\n\n.kk-composer textarea {\n\twidth: 100%;\n\tmin-height: 60px;\n\tpadding: 10px;\n\tborder: 1px solid var(--kk-border);\n\tborder-radius: 8px;\n\tresize: vertical;\n\tfont-family: inherit;\n\tfont-size: inherit;\n\tcolor: var(--kk-text);\n\tbackground: var(--kk-surface);\n}\n\n.kk-composer textarea:focus-visible {\n\toutline: var(--kk-focus);\n}\n\n.kk-button-primary {\n\tbackground: var(--kk-primary);\n\tcolor: var(--kk-primary-contrast);\n\tborder: none;\n\tpadding: 8px 16px;\n\tborder-radius: 8px;\n\tcursor: pointer;\n\tfont-weight: 500;\n\ttransition: filter 0.2s;\n\tfont-size: 14px;\n}\n\n.kk-button-primary:hover {\n\tfilter: brightness(0.95);\n}\n\n.kk-button-primary:focus-visible {\n\toutline: var(--kk-focus);\n}\n\n.kk-badge {\n\tdisplay: inline-block;\n\tpadding: 2px 8px;\n\tbackground: var(--kk-surface-2);\n\tborder: 1px solid var(--kk-border);\n\tborder-radius: 12px;\n\tfont-size: 11px;\n\tcolor: var(--kk-primary);\n\tcursor: help;\n}\n\n.kk-typing-indicator {\n\tdisplay: flex;\n\tjustify-content: flex-start;\n}\n\n.kk-typing-dots {\n\tdisplay: flex;\n\tgap: 4px;\n\tpadding: 4px 0;\n}\n\n.kk-typing-dots span {\n\twidth: 6px;\n\theight: 6px;\n\tbackground: var(--kk-text-muted);\n\tborder-radius: 50%;\n\tanimation: typing 1.4s infinite;\n}\n\n.kk-typing-dots span:nth-child(1) {\n\tanimation-delay: 0s;\n}\n\n.kk-typing-dots span:nth-child(2) {\n\tanimation-delay: 0.2s;\n}\n\n.kk-typing-dots span:nth-child(3) {\n\tanimation-delay: 0.4s;\n}\n\n@keyframes typing {\n\t0%, 60%, 100% {\n\t\ttransform: translateY(0);\n\t\topacity: 0.4;\n\t}\n\t30% {\n\t\ttransform: translateY(-6px);\n\t\topacity: 1;\n\t}\n}\n\n@media (prefers-reduced-motion: reduce) {\n\t@keyframes typing {\n\t\t0%, 100% {\n\t\t\topacity: 0.4;\n\t\t}\n\t\t50% {\n\t\t\topacity: 1;\n\t\t}\n\t}\n\t\n\t.kk-typing-dots span {\n\t\ttransform: none;\n\t}\n}\n\n/* Floating Bubble Styles */\n.kk-floating {\n\tposition: fixed;\n\tbottom: 24px;\n\tz-index: 9999;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-end;\n}\n\n.kk-floating.kk-pos-br {\n\tright: 24px;\n}\n\n.kk-floating.kk-pos-bl {\n\tleft: 24px;\n\talign-items: flex-start;\n}\n\n.kk-floating-bubble {\n\twidth: 60px;\n\theight: 60px;\n\tborder-radius: 50%;\n\tbackground: var(--kk-primary);\n\tcolor: white;\n\tborder: none;\n\tcursor: pointer;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 28px;\n\tbox-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n\ttransition: all 0.3s ease;\n\tanimation: bubble-entrance 0.5s ease;\n}\n\n.kk-floating-bubble:hover {\n\ttransform: scale(1.1);\n\tbox-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\n}\n\n.kk-floating-bubble:active {\n\ttransform: scale(0.95);\n}\n\n@keyframes bubble-entrance {\n\t0% {\n\t\topacity: 0;\n\t\ttransform: scale(0) translateY(20px);\n\t}\n\t100% {\n\t\topacity: 1;\n\t\ttransform: scale(1) translateY(0);\n\t}\n}\n\n.kk-floating .kk-sidebar {\n\tposition: fixed;\n\tbottom: 100px;\n\twidth: 360px;\n\theight: 500px;\n\tmax-height: calc(100vh - 120px);\n\tborder-radius: 12px;\n\tbox-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);\n\ttransform-origin: bottom;\n\tanimation: sidebar-slide-up 0.3s ease;\n}\n\n.kk-floating.kk-pos-br .kk-sidebar {\n\tright: 24px;\n}\n\n.kk-floating.kk-pos-bl .kk-sidebar {\n\tleft: 24px;\n}\n\n@keyframes sidebar-slide-up {\n\t0% {\n\t\topacity: 0;\n\t\ttransform: translateY(20px) scale(0.95);\n\t}\n\t100% {\n\t\topacity: 1;\n\t\ttransform: translateY(0) scale(1);\n\t}\n}\n\n/* Mobile responsive */\n@media (max-width: 640px) {\n\t.kk-floating {\n\t\tbottom: 16px;\n\t}\n\n\t.kk-floating.kk-pos-br,\n\t.kk-floating.kk-pos-bl {\n\t\tright: 16px;\n\t\tleft: auto;\n\t}\n\n\t.kk-floating-bubble {\n\t\twidth: 56px;\n\t\theight: 56px;\n\t\tfont-size: 24px;\n\t}\n\n\t.kk-floating .kk-sidebar {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\twidth: 100%;\n\t\theight: calc(100vh - 80px);\n\t\tmax-height: none;\n\t\tborder-radius: 12px 12px 0 0;\n\t}\n}\n\n/* Login Prompt */\n.kk-login-prompt {\n\tpadding: 32px;\n\ttext-align: center;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tgap: 16px;\n\theight: 100%;\n}\n\n.kk-login-prompt p {\n\tmargin: 0;\n\tcolor: var(--kk-text);\n\tfont-size: 16px;\n}\n\n.kk-login-prompt .kk-btn {\n\tpadding: 12px 24px;\n\tbackground: var(--kk-primary);\n\tcolor: white;\n\tborder: none;\n\tborder-radius: 8px;\n\ttext-decoration: none;\n\tfont-weight: 500;\n\ttransition: all 0.2s ease;\n\tdisplay: inline-block;\n}\n\n.kk-login-prompt .kk-btn:hover {\n\tbackground: var(--kk-primary);\n\tfilter: brightness(1.1);\n\ttransform: translateY(-1px);\n}\n",""]);const o=s}},n={};function e(r){var a=n[r];if(void 0!==a)return a.exports;var i=n[r]={id:r,exports:{}};return t[r](i,i.exports,e),i.exports}e.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},e.d=(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),e.nc=void 0;var r=e(72),a=e.n(r),i=e(825),s=e.n(i),o=e(659),d=e.n(o),l=e(56),c=e.n(l),k=e(540),p=e.n(k),u=e(113),b=e.n(u),f=e(389),g={};g.styleTagTransform=b(),g.setAttributes=c(),g.insert=d().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=p(),a()(f.A,g),f.A&&f.A.locals&&f.A.locals;var h=e(40),m={};m.styleTagTransform=b(),m.setAttributes=c(),m.insert=d().bind(null,"head"),m.domAPI=s(),m.insertStyleElement=p(),a()(h.A,m),h.A&&h.A.locals&&h.A.locals;var x=e(978),v={};v.styleTagTransform=b(),v.setAttributes=c(),v.insert=d().bind(null,"head"),v.domAPI=s(),v.insertStyleElement=p(),a()(x.A,v),x.A&&x.A.locals&&x.A.locals;var y=e(284),w={};w.styleTagTransform=b(),w.setAttributes=c(),w.insert=d().bind(null,"head"),w.domAPI=s(),w.insertStyleElement=p(),a()(y.A,w),y.A&&y.A.locals&&y.A.locals;class S{constructor(){this.container=null,this.railOpen=!1,this.sidebarOpen=!1,this.messages=[],this.sessionId=null,this.isTyping=!1,this.isFloating=!1,this.init()}init(){if(document.querySelector(".kk-widget.kk-initialized"))return;const t=document.querySelectorAll(".kk-widget");0!==t.length&&t.forEach(t=>{this.container=t,this.isFloating=this.container.classList.contains("kk-floating"),this.container.classList.add("kk-initialized"),this.render()})}render(){if(!this.container)return;const t=this.container.getAttribute("data-type")||"faq",n=window.KIKraftConfig;"member"!==t||n.user.loggedIn?(this.isFloating?this.renderFloating(t,n):this.renderRegular(t,n),this.attachEventListeners(),this.restoreState()):this.renderLoginPrompt()}renderFloating(t,n){this.container&&(this.container.innerHTML=`\n\t\t\t<button class="kk-floating-bubble" aria-label="Open chat" title="Chat">\n\t\t\t\t💬\n\t\t\t</button>\n\t\t\t\n\t\t\t<div class="kk-sidebar" data-theme="light" style="display: none;">\n\t\t\t\t<div class="kk-sidebar__header">\n\t\t\t\t\t<div class="kk-header-info">\n\t\t\t\t\t\t<strong>${n.branding.product_name||"KI Kraft"}</strong>\n\t\t\t\t\t\t<span class="kk-type-badge">${t.toUpperCase()}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class="kk-close-btn" aria-label="Close">✕</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="kk-chat" role="log" aria-live="polite">\n\t\t\t\t\t<div class="kk-messages"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="kk-composer">\n\t\t\t\t\t<textarea \n\t\t\t\t\t\tclass="kk-input" \n\t\t\t\t\t\tplaceholder="${n.i18n.placeholder}"\n\t\t\t\t\t\trows="1"\n\t\t\t\t\t></textarea>\n\t\t\t\t\t<button class="kk-button-primary kk-send-btn">${n.i18n.send}</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}renderRegular(t,n){this.container&&(this.container.innerHTML=`\n\t\t\t<div class="kk-rail" data-theme="light">\n\t\t\t\t${n.user.loggedIn&&n.user.avatarUrl?`<img src="${n.user.avatarUrl}" class="kk-rail-avatar" alt="User" />`:'<div class="kk-rail-avatar-placeholder">?</div>'}\n\t\t\t\t<button class="kk-rail-btn kk-chat-btn" aria-label="Open chat" title="Chat">\n\t\t\t\t\t💬\n\t\t\t\t</button>\n\t\t\t\t<button class="kk-rail-btn kk-theme-toggle" aria-label="Toggle theme" title="Theme">\n\t\t\t\t\t🌗\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="kk-sidebar" data-theme="light">\n\t\t\t\t<div class="kk-sidebar__header">\n\t\t\t\t\t<div class="kk-header-info">\n\t\t\t\t\t\t<strong>${n.branding.product_name||"KI Kraft"}</strong>\n\t\t\t\t\t\t<span class="kk-type-badge">${t.toUpperCase()}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class="kk-close-btn" aria-label="Close">✕</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="kk-chat" role="log" aria-live="polite">\n\t\t\t\t\t<div class="kk-messages"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="kk-composer">\n\t\t\t\t\t<textarea \n\t\t\t\t\t\tclass="kk-input" \n\t\t\t\t\t\tplaceholder="${n.i18n.placeholder}"\n\t\t\t\t\t\trows="1"\n\t\t\t\t\t></textarea>\n\t\t\t\t\t<button class="kk-button-primary kk-send-btn">${n.i18n.send}</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}renderLoginPrompt(){if(!this.container)return;const t="/account/";this.isFloating?this.container.innerHTML=`\n\t\t\t\t<button class="kk-floating-bubble" aria-label="Login required" title="Login">\n\t\t\t\t\t💬\n\t\t\t\t</button>\n\t\t\t\t<div class="kk-sidebar" data-theme="light" style="display: none;">\n\t\t\t\t\t<div class="kk-sidebar__header">\n\t\t\t\t\t\t<div class="kk-header-info">\n\t\t\t\t\t\t\t<strong>Mitglieder-Chat</strong>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button class="kk-close-btn" aria-label="Close">✕</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="kk-login-prompt">\n\t\t\t\t\t\t<p>Bitte melde dich an, um den Mitglieder-Chat zu nutzen.</p>\n\t\t\t\t\t\t<a href="${t}" class="kk-btn">Jetzt einloggen</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`:this.container.innerHTML=`\n\t\t\t\t<div class="kk-login-prompt">\n\t\t\t\t\t<p>Bitte melde dich an, um den Mitglieder-Chat zu nutzen.</p>\n\t\t\t\t\t<a href="${t}" class="kk-btn">Jetzt einloggen</a>\n\t\t\t\t</div>\n\t\t\t`;const n=this.container.querySelector(".kk-close-btn"),e=this.container.querySelector(".kk-floating-bubble");n&&n.addEventListener("click",()=>this.toggleSidebar()),e&&e.addEventListener("click",()=>this.toggleSidebar())}restoreState(){this.isFloating&&"true"===localStorage.getItem("kraft_ai_chat_open")&&this.openSidebar()}saveState(){this.isFloating&&localStorage.setItem("kraft_ai_chat_open",this.sidebarOpen.toString())}attachEventListeners(){if(!this.container)return;const t=this.container.querySelector(".kk-floating-bubble");t&&t.addEventListener("click",()=>this.toggleSidebar());const n=this.container.querySelector(".kk-chat-btn"),e=this.container.querySelector(".kk-theme-toggle"),r=this.container.querySelector(".kk-close-btn"),a=this.container.querySelector(".kk-send-btn"),i=this.container.querySelector(".kk-input");n?.addEventListener("click",()=>this.toggleSidebar()),r?.addEventListener("click",()=>this.toggleSidebar()),e?.addEventListener("click",()=>this.toggleTheme()),a?.addEventListener("click",()=>this.sendMessage()),i?.addEventListener("keydown",t=>{"Enter"===t.key&&(t.ctrlKey||t.metaKey)&&this.sendMessage()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.sidebarOpen&&this.toggleSidebar()})}toggleSidebar(){this.container&&this.container.querySelector(".kk-sidebar")&&(this.sidebarOpen=!this.sidebarOpen,this.sidebarOpen?this.openSidebar():this.closeSidebar(),this.saveState())}openSidebar(){if(!this.container)return;const t=this.container.querySelector(".kk-sidebar");t&&(this.sidebarOpen=!0,this.isFloating?(t.style.display="flex",t.offsetHeight,t.classList.add("open")):t.classList.add("open"),!this.sessionId&&window.KIKraftConfig.user.loggedIn&&this.createSession())}closeSidebar(){if(!this.container)return;const t=this.container.querySelector(".kk-sidebar");t&&(this.sidebarOpen=!1,t.classList.remove("open"),this.isFloating&&setTimeout(()=>{t.style.display="none"},300))}toggleTheme(){if(!this.container)return;const t=this.container.querySelector(".kk-rail"),n=this.container.querySelector(".kk-sidebar"),e="light"===(t?.getAttribute("data-theme")||"light")?"dark":"light";t?.setAttribute("data-theme",e),n?.setAttribute("data-theme",e)}async createSession(){try{const t=await fetch(`${window.KIKraftConfig.apiUrl}/member/session`,{method:"POST",headers:{"X-WP-Nonce":window.KIKraftConfig.nonce}}),n=await t.json();this.sessionId=n.session_id}catch(t){console.error("Failed to create session:",t)}}async sendMessage(){if(!this.container)return;const t=this.container.querySelector(".kk-input"),n=t.value.trim();if(n){t.value="",this.addMessage({role:"user",content:n}),this.isTyping=!0,this.renderTypingIndicator();try{const t=this.container.getAttribute("data-type")||"faq";let e="",r={};"member"===t&&this.sessionId?(e="/member/message",r={session_id:this.sessionId,message:n}):(e="/faq/query",r={query:n});const a=await fetch(`${window.KIKraftConfig.apiUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.KIKraftConfig.nonce},body:JSON.stringify(r)}),i=await a.json();this.isTyping=!1,this.removeTypingIndicator(),(i.answer||i.response)&&this.addMessage({role:"assistant",content:i.answer||i.response,sources:i.sources})}catch(t){console.error("Failed to send message:",t),this.isTyping=!1,this.removeTypingIndicator(),this.addMessage({role:"assistant",content:"Sorry, there was an error processing your request."})}}}addMessage(t){this.messages.push(t),this.renderMessages()}renderMessages(){if(!this.container)return;const t=this.container.querySelector(".kk-messages");if(!t)return;t.innerHTML=this.messages.map(t=>{const n=t.sources&&t.sources.length>0?`<div class="kk-sources">\n\t\t\t\t\t\t\t${t.sources.map(t=>`<span class="kk-badge" title="Score: ${t.score}">${t.title}</span>`).join("")}\n\t\t\t\t\t\t</div>`:"";return`\n\t\t\t\t\t<div class="kk-message ${t.role}">\n\t\t\t\t\t\t<div class="kk-bubble ${t.role}">\n\t\t\t\t\t\t\t${t.content}\n\t\t\t\t\t\t\t${n}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`}).join("");const n=this.container.querySelector(".kk-chat");n&&(n.scrollTop=n.scrollHeight)}renderTypingIndicator(){if(!this.container)return;const t=this.container.querySelector(".kk-messages");if(!t)return;const n=document.createElement("div");n.className="kk-typing-indicator",n.innerHTML='\n\t\t\t<div class="kk-bubble bot">\n\t\t\t\t<span class="kk-typing-dots">\n\t\t\t\t\t<span></span><span></span><span></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t',t.appendChild(n);const e=this.container.querySelector(".kk-chat");e&&(e.scrollTop=e.scrollHeight)}removeTypingIndicator(){if(!this.container)return;const t=this.container.querySelector(".kk-typing-indicator");t?.remove()}}function T(){new S}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",T):T()})();